# Makefile - libudis86
#
#

SHELL		= @SHELL@
top_srcdir	= @top_srcdir@
srcdir		= @srcdir@
CC		= @CC@
CFLAGS		= @CFLAGS@ -Wall -O2
LIBS		= @LIBS@
INSTALL		= @INSTALL@
INSTALL_PROGRAM	= @INSTALL_PROGRAM@
INSTALL_DATA	= @INSTALL_DATA@
prefix		= @prefix@
exec_prefix	= ${prefix}
bindir		= $(exec_prefix)/bin
libdir		= $(prefix)/lib
mandir		= @mandir@
includedir	= @includedir@
AR		= ar
RM		= rm
PERL		= perl

.SUFFIXES: .c .o
.c.o:
	${E} 'Compiling $<'
	${Q}$(CC) -c $(CFLAGS) -o $@ $<

OBJS =	mnemonics.o \
	opcmap.o \
	input.o \
	decode.o \
	syn.o \
	syn-intel.o \
	syn-pseudo.o \
	syn-att.o \
	udis86.o

libudis86.a: $(OBJS)
	$(AR) -r libudis86.a $(OBJS)
mnemonics.c: mnemonics.dat
	$(PERL) mnemonics.pl < mnemonics.dat
mnemonics.h: mnemonics.dat
	$(PERL) mnemonics.pl < mnemonics.dat
input.c: input.h types.h
opcmap.c: opcmap.h input.h types.h
decode.c: opcmap.h input.h types.h extern.h
syn-intel.c: syn.h input.h types.h opcmap.h 
syn-att.c: syn.h input.h types.h opcmap.h 
syn.c: syn.h types.h opcmap.h 
udis86.c: input.h syn.h types.h extern.h

install: libudis86.a
	${E} 'Installing'
	${Q}$(INSTALL_PROGRAM) $(srcdir)/libudis86.a $(INSTALLROOT)$(libdir)/libudis86.a
	${Q}$(srcdir)/../mkinstalldirs $(INSTALLROOT)$(includedir)/libudis86
	${Q}$(INSTALL_DATA) $(srcdir)/../udis86.h $(INSTALLROOT)$(includedir)/udis86.h
	${Q}$(INSTALL_DATA) $(srcdir)/types.h $(INSTALLROOT)$(includedir)/libudis86/types.h
	${Q}$(INSTALL_DATA) $(srcdir)/extern.h $(INSTALLROOT)$(includedir)/libudis86/extern.h
	${Q}$(INSTALL_DATA) $(srcdir)/mnemonics.h $(INSTALLROOT)$(includedir)/libudis86/mnemonics.h

uninstall:
	${E} 'Uninstalling'
	${Q}$(RM) -f $(INSTALLROOT)$(libdir)/libudis86.a
	${Q}$(RM) -frd $(INSTALLROOT)$(includedir)/libudis86
	${Q}$(RM) -f $(INSTALLROOT)$(includedir)/udis86.h

clean:
	${E} 'Cleaning src/arch/x86/udis86'
	${Q}$(MAKE) clean -f Makefile.standalone
	${Q}$(RM) -f core $(srcdir)/*.o $(srcdir)/*.a *~

distclean: clean
	${E} 'Distcleaning src/arch/x86/udis86'
	${Q}$(RM) -f config.h Makefile *~ *.log
